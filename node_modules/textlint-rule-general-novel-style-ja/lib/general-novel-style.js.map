{"version":3,"sources":["../src/general-novel-style.js"],"names":[],"mappings":"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","file":"general-novel-style.js","sourcesContent":["\"use strict\";\n\nimport {RuleHelper} from \"textlint-rule-helper\";\nimport kansuji from \"kansuji\";\n\nconst defaultOptions = {\n    // 各段落の先頭に許可する文字\n    \"chars_leading_paragraph\": \"　「『【〈《（(“\\\"‘'［[〔｛{＜<\",\n    // 閉じ括弧の手前に句読点(。、)を置かない\n    \"no_punctuation_at_closing_quote\": true,\n    // 疑問符(？)と感嘆符(！)の直後にスペースを置く\n    \"space_after_marks\": true,\n    // 連続した三点リーダー(…)の数は偶数にする\n    \"even_number_ellipsises\": true,\n    // 連続したダッシュ(―)の数は偶数にする\n    \"even_number_dashes\": true,\n    // 連続した句読点(。、)を許可しない\n    \"appropriate_use_of_punctuation\": true,\n    // 連続した中黒(・)を許可しない\n    \"appropriate_use_of_interpunct\": true,\n    // 連続した長音符(ー)を許可しない\n    \"appropriate_use_of_choonpu\": true,\n    // マイナス記号(−)は数字の前にしか許可しない\n    \"appropriate_use_of_minus_sign\": true,\n    // アラビア数字の桁数は2桁まで (false: チェックしない)\n    \"max_arabic_numeral_digits\": 2\n};\n\nfunction repeat(str, n) {\n    if (String.prototype.repeat) return String.prototype.repeat.call(str, n);\n    const arr = [];\n    for (let i = 0; i < n; i++) arr.push(str);\n    return arr.join(\"\");\n}\n\nfunction reporter(context, options = {}) {\n    const opts = Object.assign({}, defaultOptions, options);\n    const charsLeadingParagraph = opts[\"chars_leading_paragraph\"] || \"\";\n    const noPunctuationAtClosingQuote = opts[\"no_punctuation_at_closing_quote\"];\n    const spaceAfterMarks = opts[\"space_after_marks\"];\n    const evenNumberEllipsises = opts[\"even_number_ellipsises\"];\n    const evenNumberDashes = opts[\"even_number_dashes\"];\n    const appropriateUseOfPunctuation = opts[\"appropriate_use_of_punctuation\"];\n    const appropriateUseOfInterpunct = opts[\"appropriate_use_of_interpunct\"];\n    const appropriateUseOfChoonpu = opts[\"appropriate_use_of_choonpu\"];\n    const appropriateUseOfMinusSign = opts[\"appropriate_use_of_minus_sign\"];\n    const maxArabicNumeralDigits = opts[\"max_arabic_numeral_digits\"];\n\n    let helper = new RuleHelper(context);\n    let {Syntax, RuleError, fixer, report, getSource} = context;\n    return {\n        [Syntax.Paragraph](node) {\n            if (helper.isChildNode(node, [Syntax.BlockQuote])) {\n                return;\n            }\n\n            return new Promise((resolve, reject) => {\n                const text = getSource(node);\n\n                const reportMatches = ({pattern, test, message, indexer, fixer}) => {\n                    let matches;\n                    pattern.lastIndex = 0;\n                    while (matches = pattern.exec(text)) {\n                        if (!test || test.apply(null, matches)) {\n                            const range = [matches.index, matches.index + matches[0].length];\n                            const args  = [range].concat(matches);\n                            const index = indexer ? indexer.apply(null, args) : matches.index;\n                            const fix   = fixer ? fixer.apply(null, args) : null;\n                            report(node, new RuleError(message, { index, fix }));\n                        }\n                    }\n                };\n\n                if (charsLeadingParagraph) {\n                    if (charsLeadingParagraph.indexOf(text.charAt(0)) == -1) {\n                        report(node, new RuleError(`段落の先頭に許可されていない文字が存在しています`, {\n                            fix: fixer.insertTextBeforeRange([0, 0], charsLeadingParagraph[0])\n                        }));\n                    }\n                }\n\n                if (noPunctuationAtClosingQuote) {\n                    reportMatches({\n                        pattern: /[。、]+(?=[」』】〉》）\\)”\"’'］\\]〕｝\\}＞>])/g,\n                        message: \"句読点(。、)が閉じ括弧の直前に存在しています\",\n                        indexer: (range) => range[1] - 1,\n                        fixer:   (range) => fixer.removeRange(range),\n                    });\n                }\n\n                if (spaceAfterMarks) {\n                    reportMatches({\n                        pattern: /[？！](?![　？！」』】〉》）\\)”\"’'］\\]〕｝\\}＞>]|$)/g,\n                        message: \"感嘆符(！)・疑問符(？)の直後にスペースか閉じ括弧が必要です\",\n                        fixer:   (range) => fixer.insertTextAfterRange(range, \"　\"),\n                    });\n                }\n\n                if (evenNumberEllipsises) {\n                    reportMatches({\n                        pattern: /…+/g,\n                        test:    (s) => s.length % 2 == 1,\n                        message: \"連続した三点リーダー(…)の数が偶数ではありません\",\n                        fixer:   (range) => fixer.insertTextAfterRange(range, \"…\"),\n                    });\n                }\n\n                if (evenNumberDashes) {\n                    reportMatches({\n                        pattern: /―+/g,\n                        test:    (s) => s.length % 2 == 1,\n                        message: \"連続したダッシュ(―)の数が偶数ではありません\",\n                        fixer:   (range) => fixer.insertTextAfterRange(range, \"―\"),\n                    });\n                }\n\n                if (appropriateUseOfPunctuation) {\n                    reportMatches({\n                        pattern: /。。+|、、+/g,\n                        message: \"連続した句読点(。、)が使われています\",\n                        fixer:   (range, s) => fixer.replaceTextRange(range, repeat(\"……\", Math.ceil(s.length / 3))),\n                    });\n                }\n\n                if (appropriateUseOfInterpunct) {\n                    reportMatches({\n                        pattern: /・・+/g,\n                        message: \"連続した中黒(・)が使われています\",\n                        fixer:   (range, s) => fixer.replaceTextRange(range, repeat(\"……\", Math.ceil(s.length / 3))),\n                    });\n                }\n\n                if (appropriateUseOfChoonpu) {\n                    reportMatches({\n                        pattern: /ーー+/g,\n                        message: \"連続した長音符(ー)が使われています\",\n                        fixer:   (range, s) => fixer.replaceTextRange(range, repeat(\"――\", Math.ceil(s.length / 2))),\n                    });\n                }\n\n                if (appropriateUseOfMinusSign) {\n                    reportMatches({\n                        pattern: /−(?![0-9０１２３４５６７８９〇一二三四五六七八九十])/g,\n                        message: \"マイナス記号(−)の直後が数字ではありません\",\n                        fixer:   (range, s) => fixer.replaceTextRange(range, \"ー\"),\n                    });\n                }\n\n                if (typeof maxArabicNumeralDigits == \"number\") {\n                    reportMatches({\n                        pattern: /([0-9０１２３４５６７８９]+)(?:[\\.．]([0-9０１２３４５６７８９]+))?/g,\n                        test:    (s, a, b) => a.length > maxArabicNumeralDigits || (b && b.length > maxArabicNumeralDigits),\n                        message: `${maxArabicNumeralDigits}桁を超えるアラビア数字が使われています`,\n                        fixer:   (range, s) => fixer.replaceTextRange(range, kansuji(s, { wide: true })),\n                    });\n                }\n\n                resolve();\n            });\n        }\n    };\n}\n\nexport default {\n    linter: reporter,\n    fixer: reporter,\n}\n"]}