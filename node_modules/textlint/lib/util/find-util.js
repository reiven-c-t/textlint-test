// LICENSE : MIT
"use strict";

Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.pathsToGlobPatterns = pathsToGlobPatterns;
exports.findFiles = findFiles;
exports.separateByAvailability = separateByAvailability;
var pathToGlob = require("path-to-glob-pattern");
var glob = require("glob");
var path = require("path");
var fs = require("fs");
var shell = require("shelljs");
/**
 * filter files by config
 * @param {string[]} patterns glob patterns
 * @param {{extensions?: string[], cwd?: string }} options
 */
function pathsToGlobPatterns(patterns) {
    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};

    var processPatterns = pathToGlob({
        extensions: options.extensions || [],
        cwd: options.cwd || process.cwd()
    });
    return patterns.map(processPatterns);
}
/**
 * found files by glob pattern
 * @param {string[]} patterns
 * @param {{cwd?: string }} options
 * @returns {string[]} file path list
 */
function findFiles(patterns) {
    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};

    var cwd = options.cwd || process.cwd();
    var files = [];
    var addFile = function addFile(filePath) {
        if (files.indexOf(filePath) === -1) {
            files.push(filePath);
        }
    };
    patterns.forEach(function (pattern) {
        var file = path.resolve(cwd, pattern);
        if (shell.test("-f", file)) {
            addFile(fs.realpathSync(file));
        } else {
            glob.sync(pattern, {
                nodir: true
            }).forEach(function (filePath) {
                // workaround for windows
                // https://github.com/isaacs/node-glob/issues/74#issuecomment-31548810
                addFile(path.resolve(filePath));
            });
        }
    });
    return files;
}

/**
 * @param {string[]} files
 * @param {{extensions: string[]}} options
 * @returns {{availableFiles: string[], unAvailableFiles: string[]}}
 */
function separateByAvailability(files) {
    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};

    var extensions = options.extensions || [];
    var availableFiles = [];
    var unAvailableFiles = [];
    files.forEach(function (filePath) {
        var extname = path.extname(filePath);
        if (extensions.indexOf(extname) === -1) {
            unAvailableFiles.push(filePath);
        } else {
            availableFiles.push(filePath);
        }
    });
    return {
        availableFiles: availableFiles,
        unAvailableFiles: unAvailableFiles
    };
}
//# sourceMappingURL=find-util.js.map